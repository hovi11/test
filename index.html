<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>War Clicker</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-color: #ffffff;
            --text-color: #000000;
            --button-color: #007bff;
            --panel-color: #f0f0f0;
        }

        body.dark {
            --bg-color: #1e1e1e;
            --text-color: #ffffff;
            --button-color: #1a73e8;
            --panel-color: #2d2d2d;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            text-align: center;
            margin: 0;
            padding: 10px;
            transition: all 0.3s;
            user-select: none;
        }

        #click-area {
            width: 150px;
            height: 150px;
            margin: 20px auto;
            background-image: url('https://q-xx.bstatic.com/xdata/images/hotel/max500/215500382.jpg?k=bfab20a750261abbb7ea08a9886b1eb9e0a7795acd9a3aefca9830a56cccf26b&s=100x100');
            background-size: cover;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid var(--button-color);
        }

        .stats {
            margin: 10px 0;
            font-size: 18px;
        }

        .nav {
            display: flex;
            justify-content: space-around;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--panel-color);
            padding: 10px;
        }

        .nav-button {
            padding: 10px 15px;
            background-color: var(--button-color);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .menu {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: var(--panel-color);
            padding: 20px;
            border-radius: 10px;
            width: 80%;
            max-width: 400px;
            z-index: 100;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }

        .upgrade {
            margin: 10px 0;
            padding: 10px;
            background-color: var(--bg-color);
            border-radius: 5px;
            cursor: pointer;
        }

        .close-button {
            position: absolute;
            top: 5px;
            right: 10px;
            cursor: pointer;
            font-size: 20px;
        }
    </style>
</head>
<body>
    <div class="stats">
        <div>Баланс: <span id="balance">0</span></div>
        <div>Урон за клик: <span id="damage-per-click">1</span></div>
        <div>Всего нанесено урона: <span id="total-damage">0</span></div>
    </div>

    <div id="click-area" onclick="clickDamage()"></div>

    <div class="nav">
        <button class="nav-button" onclick="openMenu('shop-menu')">Магазин</button>
        <button class="nav-button" onclick="openMenu('leaderboard-menu')">Таблица лидеров</button>
        <button class="nav-button" onclick="openMenu('boost-menu')">Усиления</button>
    </div>

    <div id="shop-menu" class="menu">
        <span class="close-button" onclick="closeMenu('shop-menu')">×</span>
        <h2>Магазин</h2>
        <div id="upgrades-container"></div>
    </div>

    <div id="leaderboard-menu" class="menu">
        <span class="close-button" onclick="closeMenu('leaderboard-menu')">×</span>
        <h2>Таблица лидеров</h2>
        <div id="leaderboard-container">В разработке</div>
    </div>

    <div id="boost-menu" class="menu">
        <span class="close-button" onclick="closeMenu('boost-menu')">×</span>
        <h2>Усиления</h2>
        <div id="boosts-container"></div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        
        if (tg.colorScheme === 'dark') {
            document.body.classList.add('dark');
        }

        let balance = 0;
        let totalDamage = 0;
        let damagePerClick = 1;
        let upgrades = {
            damage1: { bought: false, cost: 50, damage: 1 },
            damage2: { bought: false, cost: 150, damage: 3 },
            damage3: { bought: false, cost: 500, damage: 10 },
            infantry: { bought: false, cost: 1000, dps: 10 },
            artillery: { bought: false, cost: 5000, dps: 50 },
            tanks: { bought: false, cost: 20000, dps: 200 }
        };
        let boosts = {
            emperor: { lastUsed: 0, active: false, duration: 60000 }
        };
        let dps = 0;
        let boostTimeout = null;

        function loadGame() {
            const savedData = localStorage.getItem('warClickerData');
            if (savedData) {
                const data = JSON.parse(savedData);
                balance = data.balance || 0;
                totalDamage = data.totalDamage || 0;
                damagePerClick = data.damagePerClick || 1;
                upgrades = data.upgrades || upgrades;
                boosts = data.boosts || boosts;
                dps = data.dps || 0;
                
                if (boosts.emperor.active) {
                    activateBoost('emperor', true);
                }
            }
            updateUI();
            startDPS();
        }

        function saveGame() {
            const gameData = {
                balance,
                totalDamage,
                damagePerClick,
                upgrades,
                boosts,
                dps
            };
            localStorage.setItem('warClickerData', JSON.stringify(gameData));
            if (window.Telegram && window.Telegram.WebApp) {
                tg.sendData(JSON.stringify(gameData));
            }
        }

        function clickDamage() {
            const damage = damagePerClick;
            balance += damage;
            totalDamage += damage;
            updateUI();
            saveGame();
        }

        function startDPS() {
            calculateDPS();
            setInterval(() => {
                if (dps > 0) {
                    balance += dps;
                    totalDamage += dps;
                    updateUI();
                    saveGame();
                }
            }, 1000);
        }

        function calculateDPS() {
            dps = 0;
            if (upgrades.infantry.bought) dps += upgrades.infantry.dps;
            if (upgrades.artillery.bought) dps += upgrades.artillery.dps;
            if (upgrades.tanks.bought) dps += upgrades.tanks.dps;
        }

        function buyUpgrade(id) {
            const upgrade = upgrades[id];
            if (!upgrade.bought && balance >= upgrade.cost) {
                balance -= upgrade.cost;
                upgrade.bought = true;
                
                if (id.startsWith('damage')) {
                    damagePerClick += upgrade.damage;
                }
                
                calculateDPS();
                updateUI();
                renderShop();
                saveGame();
            }
        }

        function activateBoost(id, fromLoad = false) {
            const boost = boosts[id];
            const now = Date.now();
            
            if (fromLoad || now - boost.lastUsed >= 24 * 60 * 60 * 1000) {
                boost.lastUsed = now;
                boost.active = true;
                
                if (id === 'emperor') {
                    damagePerClick += 2;
                    updateUI();
                    
                    if (!fromLoad) {
                        if (boostTimeout) clearTimeout(boostTimeout);
                        boostTimeout = setTimeout(() => {
                            damagePerClick -= 2;
                            boost.active = false;
                            updateUI();
                            renderBoosts();
                            saveGame();
                        }, boost.duration);
                    }
                }
                
                renderBoosts();
                saveGame();
            }
        }

        function updateUI() {
            document.getElementById('balance').textContent = balance;
            document.getElementById('damage-per-click').textContent = damagePerClick;
            document.getElementById('total-damage').textContent = totalDamage;
        }

        function openMenu(menuId) {
            document.getElementById(menuId).style.display = 'block';
            if (menuId === 'shop-menu') renderShop();
            if (menuId === 'boost-menu') renderBoosts();
        }

        function closeMenu(menuId) {
            document.getElementById(menuId).style.display = 'none';
        }

        function renderShop() {
            const container = document.getElementById('upgrades-container');
            container.innerHTML = '';
            
            for (const [id, upgrade] of Object.entries(upgrades)) {
                if (!upgrade.bought) {
                    container.innerHTML += `
                        <div class="upgrade" onclick="buyUpgrade('${id}')">
                            <strong>${id.startsWith('damage') ? 'Улучшение урона' : 'Поддержка'} ${id.replace(/\D/g,'') || id}</strong><br>
                            ${id.startsWith('damage') ? `+${upgrade.damage} урона за клик` : `+${upgrade.dps} урона в секунду`}<br>
                            Цена: ${upgrade.cost}
                        </div>
                    `;
                }
            }
        }

        function renderBoosts() {
            const container = document.getElementById('boosts-container');
            const boost = boosts.emperor;
            const now = Date.now();
            const cooldown = 24 * 60 * 60 * 1000;
            const remaining = Math.max(0, cooldown - (now - boost.lastUsed));
            const hours = Math.floor(remaining / (60 * 60 * 1000));
            
            container.innerHTML = `
                <div class="upgrade" onclick="activateBoost('emperor')" 
                     style="${boost.active || remaining > 0 ? 'opacity: 0.7;' : ''}">
                    <strong>За императора!</strong><br>
                    +2 урона за клик на 1 минуту<br>
                    ${boost.active ? 'Активно' : 
                      remaining > 0 ? `Доступно через: ${hours}ч` : 'Готово к использованию'}
                </div>
            `;
        }

        setInterval(saveGame, 300000);
        tg.ready();
        loadGame();
    </script>
</body>
</html>
